<script type="module" src="pages/text/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/marked@9.1.2/marked.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/dompurify@3.2.6/dist/purify.min.js"></script>

<style>
  /* Remove list markers only from task lists (lists with checkboxes) */
  #text_content_markdown ul:has(input[type="checkbox"]) {
      list-style: none;
      padding-left: 1rem;
  }

  #text_content_markdown li:has(input[type="checkbox"]) {
      list-style: none;
  }

  /* Scrolling title for long file names */
  #text_file_modal_title span {
      display: inline-block;
      max-width: 100%;
  }
  #text_file_modal_title .scrolling-title {
      display: inline-block;
      white-space: nowrap;
  }
  #text_file_modal_title:hover .scrolling-title {
      animation: scroll-title 6s linear infinite;
  }
  @keyframes scroll-title {
      0%   { transform: translateX(0); }
      10%  { transform: translateX(0); }
      90%  { transform: translateX(calc(-100% + 200px)); }
      100% { transform: translateX(calc(-100% + 200px)); }
  }
</style>

<div class="container is-fluid columns is-centered py-6 mb-6">
  <aside class="column is-2 menu">
    <p class="menu-label is-hidden">Path to local text library</p>
    <div class="field has-addons is-hidden">
      <div class="control is-expanded">
        <input class="input is-fullwidth" id="path_to_media_folder" type="text" placeholder="Write folder path here">
      </div>
      <div class="control">
        <button class="button is-info" id="update_path_to_media_folder">Save</button>
      </div>
    </div>
  </aside>

  <div class="column">
    <!-- Search bar component mount point -->
    <div id="search_bar_container" class="mb-4"></div>

    <!-- Pagination and status on top-->
    <nav class="level mt-6">
      <nav class="pagination is-rounded level-left mb-0" role="navigation" aria-label="pagination">    
        <ul class="pagination-list">
          <li>
            <span class="pagination-ellipsis">&hellip;</span>
          </li>
        </ul>
      </nav>
      <div class="level-right">
        <p class="search-status">...</p>
      </div>
    </nav>

    <div id="text_files_grid_container"> 
      <!-- Text files will be listed here -->
    </div>

    <!-- Pagination and status on bottom-->
    <nav class="pagination is-rounded mt-6" role="navigation" aria-label="pagination">
      <nav class="pagination is-rounded level-left mb-0" role="navigation" aria-label="pagination">    
        <ul class="pagination-list">
          <li>
            <span class="pagination-ellipsis">&hellip;</span>
          </li>
        </ul>
      </nav>
      <div class="level-right">
        <p class="search-status">...</p>
      </div>
    </nav>
  </div>
</div>

<!-- Modal for Text File Viewer/Editor -->
<div class="modal" id="text_file_modal">
  <div class="modal-background modal-close-action"></div>
  <div class="modal-card" style="width: 80%; max-width: 960px; height: 90vh; display: flex; flex-direction: column;">
    <header class="modal-card-head" style="align-items: center;">
      <p class="modal-card-title" id="text_file_modal_title" style="flex: 1 1 0; min-width: 0; overflow: hidden; white-space: nowrap; margin-bottom: 0;">
        <span style="display: inline-block; max-width: 100%; overflow: hidden; white-space: nowrap;">
          <span class="scrolling-title">File Content</span>
        </span>
      </p>
      <span id="text_file_modal_rating" style="flex-shrink: 0; margin-left: 1rem; margin-right: 1rem;"></span>
      <button class="delete modal-close modal-close-action" aria-label="close" style="flex-shrink: 0;"></button>
    </header>
    <section class="modal-card-body" style="flex: 1; display: flex; flex-direction: column; padding-bottom: 0;">
      <!-- Tabs - fixed position -->
      <div class="tabs is-toggle is-fullwidth is-normal" style="flex-shrink: 0; margin-bottom: 1rem;">
          <ul>
              <li class="is-active" data-tab="raw">
                  <a><span>Raw Text</span></a>
              </li>
              <li data-tab="markdown">
                  <a><span>Markdown</span></a>
              </li>
              <li data-tab="html">
                  <a><span>HTML</span></a>
              </li>
          </ul>
      </div>


      <!-- Content container with controlled overflow -->
      <div id="text_viewer_raw" class="tab-content" style="flex: 1; display: flex; flex-direction: column;">
        <textarea class="textarea" id="text_content_textarea" placeholder="File content..." 
          style="flex-grow: 1;
                 min-height: 0;
                 font-family: 'Courier New', monospace;
                 resize: none;
                 max-height: -webkit-fill-available;"></textarea>
      </div>
      <div id="text_viewer_markdown" class="tab-content" style="flex: 1; display: flex; flex-direction: column; overflow: auto;">
        <div class="content" id="text_content_markdown" style="height: 100%; border: 1px solid var(--bulma-border-color); padding: 10px; overflow-y: auto;">
          <!-- Markdown content will be rendered here -->
        </div>
      </div>
      <div id="text_viewer_html" class="tab-content" style="flex: 1; display: flex; flex-direction: column; overflow: auto;">
        <div class="content" id="text_content_html" style="height: 100%; border: 1px solid var(--bulma-border-color); padding: 10px; overflow-y: auto;">
          <!-- HTML content will be rendered here -->
        </div>
      </div>
    </section>
    <footer class="modal-card-foot">
      <button class="button is-success modal-save-action">Save changes</button>
      <button class="button modal-close-action">Cancel</button>
    </footer>
  </div>
</div>